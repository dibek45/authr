generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
  output        = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Comprador {
  id       Int      @id @default(autoincrement())
  nombre   String
  email    String   @unique
  telefono String?
  boletos  Boleto[]
  creadoEn DateTime @default(now())

  referidoId Int?
  referido   Comprador?  @relation("Referido", fields: [referidoId], references: [id])
  referidos  Comprador[] @relation("Referido")
}

model Vendedor {
  id        Int      @id @default(autoincrement())
  nombre    String
  email     String   @unique
  rol       String   @default("vendedor") // "admin" o "vendedor"
  boletos   Boleto[]
  createdAt DateTime @default(now())
}

model Boleto {
  id          Int        @id @default(autoincrement())
  numero      Int
  precio      Float
  estado      String     @default("disponible") // vendido, cancelado, disponible
  metodoPago  String?
  fechaCompra DateTime?
  comprador   Comprador? @relation(fields: [compradorId], references: [id])
  compradorId Int?
  vendedor    Vendedor?  @relation(fields: [vendedorId], references: [id])
  vendedorId  Int?
  sorteo      Sorteo     @relation(fields: [sorteoId], references: [id])
  sorteoId    Int
}

model Usuario {
  id               Int              @id @default(autoincrement())
  nombre           String
  email            String           @unique
  password         String
  rol              String           @default("admin")
  cuentasBancarias CuentaBancaria[] @relation("UsuarioCuentas")
  sorteos          Sorteo[]         @relation("AdminSorteos")
}

model CuentaBancaria {
  id        Int      @id @default(autoincrement())
  banco     String
  numero    String
  titular   String
  usuario   Usuario  @relation("UsuarioCuentas", fields: [usuarioId], references: [id])
  usuarioId Int
  sorteos   Sorteo[] // ðŸ‘ˆ una cuenta puede estar en muchos sorteos
}

model Sorteo {
  id                        Int       @id @default(autoincrement())
  nombre                    String
  descripcion               String?
  imagen                    String?
  fecha                     DateTime
  cierreVentas              DateTime?
  costoBoleto               Float?
  totalBoletos              Int?
  boletosVendidos           Int?
  estado                    String?
  numeroWhatsApp            String?
  nombreEmpresa             String?
  linkfacebook              String?
  numeroCuenta              String?
  tipoBanco                 String?
  numeroDeSorteo            String?
  mensajeWhatsappInfo       String?
  mensajeWhatsappApartado   String?
  mensajeWhatsappConfirmado String?
  mensajeWhatsappAnuncio    String?

  boletos Boleto[]

  cuentaBancariaId Int?
  cuentaBancaria   CuentaBancaria? @relation(fields: [cuentaBancariaId], references: [id])

  adminId Int
  admin   Usuario @relation("AdminSorteos", fields: [adminId], references: [id])
}
